<div class="topbar">
  <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>
</div>
<aside class="sidebar" id="sidebar">
  <div class="sidebar-container">
    <div class="logo-container">
      <%= link_to root_path do %>
        <%= image_tag "logo.svg", class: "logo" %><%= image_tag "title.svg", class: "title" %>
      <% end %>
    </div>

    <% if current_user.present? %>
      <% role_name = current_user.role&.name %>
      <% perm_service = PermissionService.new(current_user) %>
      <nav class="nav-menu">
        <ul>
        <% if ["ผู้ดูแลระบบ", "ผู้ประสารงาน", "อาจารย์","นักศึกษา"].include?(role_name) %>
            <li class="nav-item has-submenu">
              <button type="button" class="nav-link submenu-toggle">
                <%= image_tag "news.svg", class: "icon" %>
                <span>ข่าวสาร</span>
                <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 320 512"><path fill="currentColor" d="M96 96l128 128-128 128z"/></svg>
              </button>
              <ul class="submenu">
                <li><%= link_to "ข่าวสารทั้งหมด", "/news/index", class: "nav-link" %></li>
        <% if ["ผู้ดูแลระบบ", "ผู้ประสารงาน", "อาจารย์","นักศึกษา"].include?(role_name) %>
                  <li><%= link_to "สร้างข่าวสาร", "/news/new", class: "nav-link" %></li>
                <% end %>
              </ul>
            </li>
          <% end %>

        <% if ["ผู้ดูแลระบบ", "ผู้ประสารงาน", "อาจารย์","นักศึกษา"].include?(role_name) %>
            <li class="nav-item has-submenu">
              <button type="button" class="nav-link submenu-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" height="20" width="25" viewBox="0 0 640 512"><path d="..."/></svg>
                <span>อาจารย์ที่ปรึกษา</span>
                <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 320 512"><path fill="currentColor" d="M96 96l128 128-128 128z"/></svg>
              </button>
              <ul class="submenu">
        <% if ["ผู้ดูแลระบบ", "ผู้ประสารงาน", "อาจารย์","นักศึกษา"].include?(role_name) %>
                  <li><%= link_to "ดูทั้งหมด", "/advisors/index", class: "nav-link" %></li>
                <% end %>
        <% if ["ผู้ดูแลระบบ", "ผู้ประสารงาน", "อาจารย์","นักศึกษา"].include?(role_name) %>
                  <li><%= link_to "สมาชิก", "/advisors/detail_group", class: "nav-link" %></li>
        <% if ["ผู้ดูแลระบบ", "ผู้ประสารงาน", "อาจารย์","นักศึกษา"].include?(role_name) %>
                    <li><%= link_to "สร้างกลุ่ม", "/advisors/new", class: "nav-link" %></li>
                  <% end %>
                <% end %>
              </ul>
            </li>
          <% end %>

        <% if ["ผู้ดูแลระบบ", "ผู้ประสารงาน", "อาจารย์","นักศึกษา"].include?(role_name) %>
            <li class="nav-item">
              <%= link_to "/reports/index", class: "nav-link" do %>
                <%= image_tag "report.svg", class: "icon" %>
                <span>รูปแบบรายงาน</span>
              <% end %>
            </li>
          <% end %>

        <% if ["ผู้ดูแลระบบ", "ผู้ประสารงาน", "อาจารย์","นักศึกษา"].include?(role_name) %>
            <li class="nav-item">
              <%= link_to "/students/index", class: "nav-link" do %>
                <svg xmlns="http://www.w3.org/2000/svg" height="20" width="25" viewBox="0 0 640 512"><path d="..."/></svg>
                <span>คำข้อร้องจากนักศึกษา</span>
              <% end %>
            </li>
          <% end %>

        <% if ["ผู้ดูแลระบบ", "ผู้ประสารงาน", "อาจารย์","นักศึกษา"].include?(role_name) %>
            <li class="nav-item">
              <%= link_to "/roles", class: "nav-link" do %>
                <svg xmlns="http://www.w3.org/2000/svg" height="20" width="22.5" viewBox="0 0 576 512"><path d="..."/></svg>
                <span>roles</span>
              <% end %>
            </li>
          <% end %>

        <% if ["ผู้ดูแลระบบ", "ผู้ประสารงาน", "อาจารย์","นักศึกษา"].include?(role_name) %>
            <li class="nav-item">
              <%= link_to "/seasons", class: "nav-link" do %>
                <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 512 512"><path d="..."/></svg>
                <span>seasons</span>
              <% end %>
            </li>
          <% end %>
        </ul>
      </nav>
    </div>

    <div class="user-profile">
      <div class="user-info">
        <p class="user-name"><%= current_user.name %></p>
        <p class="user-role"><%= current_user.role&.name || "-" %></p>
      </div>
      <%= link_to "↗", destroy_user_session_path, method: :delete, class: "profile-link" %>
    </div>
  <% end %>
</aside>

<script>
  function toggleSidebar() {
    const sidebar = document.getElementById("sidebar");
    sidebar.classList.toggle("open");
  }

  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".submenu-toggle").forEach(button => {
      button.addEventListener("click", () => {
        const parent = button.closest(".has-submenu");
        parent.classList.toggle("open");
      });
    });
  });
</script>
